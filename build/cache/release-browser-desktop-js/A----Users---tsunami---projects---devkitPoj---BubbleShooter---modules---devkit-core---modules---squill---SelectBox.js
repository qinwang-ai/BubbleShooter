465680315b913bfa9592c1e07caa8640
jsio("import .Widget");jsio("import squill.models.DataSource as DataSource");jsio("from util.browser import $");
var Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_SelectBox=__class__,SelectBox=exports=Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_SelectBox(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(f){this._css="select";this._def={tag:"label",style:{display:"inline-block"},children:[{id:"_select",tag:"select"}]};this.init=function(a){a=merge(a,{renderer:bind(this,"defaultRenderer")});this._items={};a.dataSource&&
this.setDataSource(a.dataSource);f(this,"init",arguments)};this.buildWidget=function(){this._opts.name&&this.setName(this._opts.name);this._dataSource||this.setDataSource(new DataSource);if(this._opts.items){var a=1;this._dataSource.add(this._opts.items.map(function(b){if("object"!=typeof b)return{id:"string"==typeof b?b:a++,value:b};b.id||(b.id="value"in b?b.value:"title"in b?b.title:a++);return b}))}"value"in this._opts&&this.setValue(this._opts.value);this.initMouseEvents(this._el);$.onEvent(this._select,
"change",this,"_onSelect")};this._onSelect=function(){var a=this._dataSource.get(this.getValue());a&&this.publish("change",a)};this.getDataSource=function(){return this._dataSource};this.setDataSource=function(a){this._dataSource&&(this._dataSource.unsubscribe("Update",this),this._dataSource.unsubscribe("Remove",this));this._dataSource=a;this._dataSource.subscribe("Update",this,"onUpdateItem");this._dataSource.subscribe("Remove",this,"onRemoveItem");this._dataSource.forEach(function(a,c){this.onUpdateItem(c,
a)},this)};this.defaultRenderer=function(a){var b=this._dataSource.getKey();return a.displayName||a.label||a.title||a.text||a[b]};this.onUpdateItem=function(a,b){var c=this._items[a],e=this._dataSource.getKey();if("string"===typeof b){var d={};d[e]=b;b=d}c||(c=this._items[a]=$.create({tag:"option"}),$.insertBefore(this._select,c));c.setAttribute("value",b[e]);d=this._opts.renderer;c.innerText="string"===typeof d?b[d]:d(b);c.value=b[e]};this.onRemoveItem=function(a){var b=this._items[a],c=this.getValue();
b&&($.remove(b),delete this._items[a]);this.getValue()!=c&&this._onSelect()};this.setName=function(a){this._select.name=a};this.setValue=function(a){this._select.value=a};this.getValue=function(){return this._select.value}});
