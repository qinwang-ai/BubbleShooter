f1bf29395cf64a36d864b5e08e67c14a
jsio("from util.browser import $");jsio("import .Widget");
var elementIDPrefix=0,Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_TreeList=__class__,TreeList=exports=Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_TreeList(function(){return this.init&&this.init.apply(this,arguments)},Widget,function(i){var j={key:"id",label:"title",wrapperId:"browser",contentId:"contentWrapper"};this.init=function(a){a=a||{};a=merge(a,j);this._initClasses(a);this._key=a.key;this._label=a.label;this._wrapperId=
a.wrapperId;this._contentId=a.contentId;this._leaveWidth=a.leaveWidth||600;elementIDPrefix++;this._elementIDPrefix="menuItem"+elementIDPrefix+"_";a.dataSource?this.setDataSource(a.dataSource):this._dataSource=null;this._def={id:this._wrapperId,className:"browser",children:[{id:this._contentId,className:"contentWrapper",children:[]}]};this._root=null;this._itemByKey={};i(this,"init",arguments)};this._initClasses=function(a){this._classNames={nodeWrapper:a.nodeWrapper||"browserNodeWrapper",nodeWrapperHidden:a.nodeWrapperHidden||
"browserNodeWrapperHidden",node:a.node||"browserNode",nodeChildren:a.nodeChildren||"children",nodeActive:a.nodeActive||"active",nodeActiveChild:a.nodeActiveChild||"browserNodeActiveChild"}};this._clearItem=function(a){var c,b,d,e;if(a.children)for(b=a.children;b.length;)this._clearItem(b.pop());if(a.parent){c=a.parent;b=c.children;d=0;for(e=b.length;d<e;d++)if(b[d]===a){b.splice(d,1);break}!b.length&&c.group&&($.remove(c.group.parentNode),$.remove(c.group),delete c.group)}$.remove(a.node);a.group&&
$.remove(a.group)};this._createMenuId=function(a){var c=this._menuId;a&&this._menuId++;return this._elementIDPrefix+c};this._createGroup=function(a){var c=this._createMenuId(!0),a=$({parent:$({parent:$.id(this._contentId),id:c,className:a?this._classNames.nodeWrapper:this._classNames.nodeWrapperHidden}),className:this._classNames.node});a.menuId=c;return a};this._createItem=function(a,c){var b=this._createMenuId(!0);a.node=$({parent:c,id:b,tag:"a",text:a[this._label]});$.onEvent(b,"click",this,"onClick",
a)};this.buildWidget=function(){this._menuId=0;this._menuById=[];this._menuStack=[];this._menuActiveItem=!1;null!==this._dataSource&&this._dataSource.each(bind(this,this.onCreateItem))};this._removeFromStack=function(a){for(var c=this._menuStack,b=null;c.length&&c[c.length-1].depth>=a;)b=c.pop(),$.removeClass(b.node.id,this._classNames.nodeActive),$.removeClass(b.node.id,this._classNames.nodeActiveChild),b.group&&($.addClass(b.group.menuId,this._classNames.nodeWrapperHidden),$.removeClass(b.group.menuId,
this._classNames.nodeWrapper));return b};this.applyNodeStyle=function(a){a.children&&a.children.length?$.addClass(a.node,this._classNames.nodeChildren):$.removeClass(a.node,this._classNames.nodeChildren);a===this._menuActiveItem?$.addClass(a.node,this._classNames.nodeActive):$.removeClass(a.node,this._classNames.nodeActive);void 0!==a.removeCustomClass&&a.removeCustomClass&&$.removeClass(a.node,a.removeCustomClass);void 0!==a.customClass&&a.customClass&&($.removeClass(a.node,a.customClass),$.addClass(a.node,
a.customClass))};this._addToStack=function(a){this._menuStack.push(a);this.applyNodeStyle(a);if(a.children&&a.children.length){if(!a.group){var c,b,d;a.children.sort();a.group=this._createGroup(!0);b=0;for(d=a.children.length;b<d;b++)c=a.children[b],this._createItem(c,a.group),this.publish("DisplayItem",c.data,c),this.applyNodeStyle(c)}$.addClass(a.group.menuId,this._classNames.nodeWrapper);$.removeClass(a.group.menuId,this._classNames.nodeWrapperHidden)}};this.onClick=function(a){var c=this._menuStack,
b=null;this.publish("SelectItem",a.data,a);this._menuActiveItem&&(b=this._menuActiveItem,this._menuActiveItem=null,this.applyNodeStyle(b),b=null);c.length&&a.depth<=c[c.length-1].depth&&(b=this._removeFromStack(a.depth));b!==a&&this._addToStack(a);this._menuActiveItem=a;this.applyNodeStyle(a);c.length&&(a=c.length,c[c.length-1].children&&c[c.length-1].children.length&&a++,$.id(this._contentId).style.width=200*a+this._leaveWidth+"px")};this.onUpdateItem=function(a,c){var b={title:a[this._label],toString:function(){return this.title}},
d,e,g,f,h;if(this._itemByKey[c])this._itemByKey[c].node&&(this._itemByKey[c].node.innerHTML=a[this._label]);else{if(null===a.parent||-1===a.parent)null===this._root&&(this._rootGroup=this._createGroup(!0),this._createItem(b,this._rootGroup),this._root=b,b.data=a,b.depth=0,b.parent=null,this.publish("DisplayItem",b.data,b),this.applyNodeStyle(b));else{if(d=this._itemByKey[a.parent[this._key]])if(d.children||(d.children=[]),e=d.children,this._menuActiveItem&&(this._menuActiveItem===d||this._menuActiveItem.parent===
d)){f=0;for(h=e.length;f<h;f++)e[f].node&&($.remove(e[f].node),e[f].node=null);e.push(b);e.sort();d.group||(d.group=this._createGroup(!0),$.id(this._contentId).style.width=200*(this._menuStack.length+1)+500+"px");f=0;for(h=e.length;f<h;f++)g=e[f],this._createItem(g,d.group),this.publish("DisplayItem",g.data,g),this.applyNodeStyle(g)}else e.push(b);b.depth=d.depth+1;b.parent=d}b.data=a;this._itemByKey[c]=b}};this.onCreateItem=function(a){this.onUpdateItem(a,a[this._key])};this.onRemoveItem=function(a,
c){var b=this._itemByKey[c],d;b&&(b=1>=b.parent.children.length,d=a[this._dataSource.parentKey],this._removeFromStack(this._itemByKey[c].depth-1),this._clearItem(this._itemByKey[c]),this._menuActiveItem=!1,delete this._itemByKey[c],this.publish("UnSelectItem"),b&&d&&(b=this._itemByKey[d[this._dataSource.key]],this.publish("DisplayItem",b.data,b),this.applyNodeStyle(b)))};this.showItem=function(a){var c=this.getTreeNode(a);this.publish("DisplayItem",a,c);this.applyNodeStyle(c)};this.setDataSource=
function(a){this._dataSource=a;this._dataSource.subscribe("Update",this,this.onUpdateItem);this._dataSource.subscribe("Remove",this,this.onRemoveItem)};this.getPathString=function(a){var c="",b=this._menuStack,d,e,a=a||" ";d=0;for(e=b.length;d<e;d++)""!==c&&(c+=a),c+=b[d].data[this._label];return c};this.getTreeNode=function(a){return this._itemByKey[a[this._dataSource.key]]}});
