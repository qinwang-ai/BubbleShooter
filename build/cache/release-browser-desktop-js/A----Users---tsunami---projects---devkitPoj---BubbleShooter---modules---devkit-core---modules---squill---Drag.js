6b75d60f895aa81b720ed998dc1a23e4
jsio("import lib.PubSub");jsio("import math.geom.Point as Point");jsio("from util.browser import $");var gCurrentDrag=[],gCurrentMouse={x:0,y:0};
function resolveMouse(b){if(b.touches)return resolveMouse(b.touches[0]);if("pageX"in b)gCurrentMouse.x=b.pageX,gCurrentMouse.y=b.pageY;else{var a=document.documentElement,c=document.body;gCurrentMouse.x=b.clientX+(a&&a.scrollLeft||c&&c.scrollLeft||0)-(a&&a.clientLeft||c&&c.clientLeft||0);gCurrentMouse.y=b.clientY+(a&&a.scrollTop||c&&c.scrollTop||0)-(a&&a.clientTop||c&&c.clientTop||0)}}var _active=!1;function gAddItem(b){gRemoveItem(b);gCurrentDrag.push(b);_active=!0}
function gRemoveItem(b){for(var a=0;a<gCurrentDrag.length;++a)gCurrentDrag[a]==b&&(gCurrentDrag.splice(a,1),--a);gCurrentDrag[0]||(_active=!1)}function onMove(b){if(_active){resolveMouse(b);for(var a=0;a<gCurrentDrag.length;++a)gCurrentDrag[a].onMouseMove(b)}}function onUp(b){if(_active)for(var a=0;a<gCurrentDrag.length;++a)gCurrentDrag[a].onMouseUp(b)}
function registerWindow(b){var a=b.document;"ontouchstart"in b?(a.addEventListener("touchstart",resolveMouse,!0),a.addEventListener("touchmove",onMove,!0),a.addEventListener("touchend",onUp,!0)):(a.addEventListener("mousedown",resolveMouse,!0),a.addEventListener("mousemove",onMove,!0),a.addEventListener("mouseup",onUp,!0))}var Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_Drag=__class__;
exports=Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_Drag(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){this.init=function(){this._isActive=!1};this.isDragging=function(){return this._isActive};this.startDrag=function(b,a){var c=this._evt=new exports.DragEvent;this._evt.data=a;this._evt.params=merge(b,{threshold:5});c.srcPt=new Point(gCurrentMouse);c.currPt=new Point(gCurrentMouse);gAddItem(this)};this.onMouseMove=function(b){var a=
this._evt,c=Point.subtract(gCurrentMouse,a.srcPt);!this._isActive&&c.getMagnitude()>a.params.threshold&&(this._isActive=!0,this.disableIframes(b.target&&(b.target.ownerDocument||9==b.target.nodeType&&b.target)),this.publish("DragStart",a));this._isActive&&($.stopEvent(b),a.prevPt=a.currPt,a.currPt=new Point(gCurrentMouse),this.publish("Drag",a,b,Point.subtract(a.currPt,a.prevPt)))};this.onMouseUp=function(b){gRemoveItem(this);if(this._isActive)return $.stopEvent(b),this._isActive=!1,this.enableIframes(),
this.publish("DragStop",this._evt,b),!0};this.disableIframes=function(b){this._disabledFrames||(this._disabledFrames=[]);$("iframe",b).forEach(function(a){try{this._disabledFrames.push({frame:a,pointerEvents:a.style.pointerEvents});a.style.pointerEvents="none"}catch(b){}},this)};this.enableIframes=function(){this._disabledFrames.splice(0,this._disabledFrames.length).forEach(function(b){b.frame.style.pointerEvents=b.pointerEvents})}});exports.registerWindow=registerWindow;exports.DragEvent=__class__;
exports.DragEvent=exports.DragEvent(function(){return this.init&&this.init.apply(this,arguments)},function(){});var win=window;for(registerWindow(win);win.parent!=win;){win=win.parent;try{registerWindow(win)}catch(e$$13){}};
