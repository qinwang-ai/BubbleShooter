6d7c0f8dbc5dad07424367f16620e117
jsio("import ui.ImageView");jsio("import ui.TextView");jsio("import animate");jsio("import src.Config as config");jsio("import src.SoundController as Sound");jsio("import util.ajax as ajax");jsio("import ui.ParticleEngine as ParticleEngine");var Users_tsunami_projects_devkitPoj_BubbleShooter_src_GameOverScreen=__class__;
exports=Users_tsunami_projects_devkitPoj_BubbleShooter_src_GameOverScreen(function(){return this.init&&this.init.apply(this,arguments)},ui.ImageView,function(h){this.init=function(b){b=merge(b,{x:0,y:0,width:GLOBAL.SCREEN_SIZE.width,height:GLOBAL.SCREEN_SIZE.height,image:"resources/images/background_4.jpg"});h(this,"init",[b]);this._sound=Sound.getSound();this._spark=!1;this.build()};this.build=function(){var b=new ui.TextView({superview:this,x:0,y:290,width:GLOBAL.SCREEN_SIZE.width,height:190,size:19,
fontFamily:"Comic Sans MS",verticalAlign:"middle",horizontalAlign:"center",wrap:!0,color:"#FF9800",opacity:1,autoFontSize:!1}),d=new ui.TextView({superview:this,x:0,y:255,width:GLOBAL.SCREEN_SIZE.width,height:40,size:30,fontFamily:"Comic Sans MS",verticalAlign:"middle",horizontalAlign:"center",color:"#fe546c",opacity:1,autoFontSize:!1}),a=new ui.TextView({superview:this,x:0,y:120,fontFamily:"Comic Sans MS",width:GLOBAL.SCREEN_SIZE.width,height:50,size:35,verticalAlign:"middle",horizontalAlign:"center",
wrap:!1,color:"#fffc88",opacity:1,text:"Time: 00:00"}),g=new ui.TextView({superview:this,x:0,fontFamily:"Comic Sans MS",y:50,width:GLOBAL.SCREEN_SIZE.width,height:40,size:25,verticalAlign:"middle",horizontalAlign:"center",wrap:!1,color:"#fffc88",opacity:1,text:"network error"});new ui.TextView({superview:this,x:0,y:460,fontFamily:"Comic Sans MS",width:GLOBAL.SCREEN_SIZE.width,height:50,size:35,verticalAlign:"middle",horizontalAlign:"center",wrap:!1,color:"#fff",opacity:1,text:"Click to Go On"});this._pEngine=
new ParticleEngine({superview:this});this.on("gameoverscreen:score",function(c){c?(this._sound.play("win"),this._spark=!0,setTimeout(bind(this,function(){this._spark=!1}),1E3),a.setText("Time: "+c),ajax.get({url:config.serverUrl,data:{score:c}},function(a,e){if(a)console.log(a),g.setText("network error");else{e=eval("("+e+")");g.setText(e.rank.toString()+"th");d.setText("Best: "+e.scoreList[0]);for(var c="",f=1;f<e.scoreList.length;f++)c+=(f+1).toString()+"th: "+e.scoreList[f]+"\n";b.setText(c)}})):
(this._sound.play("lose"),a.setText("Lose"),g.setText("no rank"),b.setText(""),d.setText(""))});GC.app.engine.on("Tick",bind(this,function(){this._pEngine.runTick(400);this._spark&&this.spark()}))};this.spark=function(){for(var b=this._pEngine.obtainParticleArray(50),d=0;50>d;d++){var a=b[d];a.dx=400*Math.random();a.dy=400*Math.random();a.width=15;a.height=15;a.image="resources/images/spark.png"}this._pEngine.emitParticles(b)}});
