4395ba41250fcf4c8796999cf2f5e106
var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\u00b7\u0300-\u036f\\ux203F-\u2040]"),tagNamePattern=RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_S=2,S_EQ=3,S_V=4,S_E=5,S_S=6,S_C=7;function XMLReader(){}
XMLReader.prototype={parse:function(a,b,c){var e=this.domBuilder;e.startDocument();_copy(b,b={});parse(a,b,c,e,this.errorHandler);e.endDocument()}};
function parse(a,b,c,e,d){function g(a){var b=a.slice(1,-1);if(b in c)return c[b];if("#"===b.charAt(0))return a=parseInt(b.substr(1).replace("x","0x")),65535<a?(a-=65536,a=String.fromCharCode(55296+(a>>10),56320+(a&1023))):a=String.fromCharCode(a),a;d.error("entity not found:"+a);return a}function i(b){var c=a.substring(p,b).replace(/&#?\w+;/g,g);j&&f(p);e.characters(c,0,b-p);p=b}function f(b,c){for(;b>=n&&(c=k.exec(a));)h=c.index,n=h+c[0].length,j.lineNumber++;j.columnNumber=b-h+1}for(var h=0,n=
0,k=/.+(?:\r\n?|\n)|.*$/g,j=e.locator,b=[{currentNSMap:b}],w={},p=0;;){var l=a.indexOf("<",p);if(0>l){if(!a.substr(p).match(/^\s*$/)){var m=e.document,r=m.createTextNode(a.substr(p));m.appendChild(r);e.currentElement=r}break}l>p&&i(l);switch(a.charAt(l+1)){case "/":var m=a.indexOf(">",l+3),s=a.substring(l+2,m),q=b.pop(),t=q.localNSMap;q.tagName!=s&&d.fatalError("end tag name: "+s+" is not match the current start tagName:"+q.tagName);e.endElement(q.uri,q.localName,s);if(t)for(r in t)e.endPrefixMapping(r);
m++;break;case "?":j&&f(l);m=parseInstruction(a,l,e);break;case "!":j&&f(l);m=parseDCC(a,l,e,d);break;default:try{j&&f(l);var o=new ElementAttributes,m=parseElementStartPart(a,l,o,g,d),u=o.length;if(u&&j){for(var x=copyLocator(j,{}),l=0;l<u;l++){var v=o[l];f(v.offset);v.offset=copyLocator(j,{})}copyLocator(x,j)}!o.closed&&fixSelfClosed(a,m,o.tagName,w)&&(o.closed=!0,c.nbsp||d.warning("unclosed xml attribute"));appendElement(o,e,b);"http://www.w3.org/1999/xhtml"===o.uri&&!o.closed?m=parseHtmlSpecialContent(a,
m,o.tagName,g,e):m++}catch(y){d.error("element parse error: "+y),m=-1}}0>m?i(l+1):p=m}}function copyLocator(a,b){b.lineNumber=a.lineNumber;b.columnNumber=a.columnNumber;return b}
function parseElementStartPart(a,b,c,e,d){for(var g,i,f=++b,h=S_TAG;;){var n=a.charAt(f);switch(n){case "=":if(h===S_ATTR)g=a.slice(b,f),h=S_EQ;else if(h===S_ATTR_S)h=S_EQ;else throw Error("attribute equal must after attrName");break;case "'":case '"':if(h===S_EQ)if(b=f+1,f=a.indexOf(n,b),0<f)i=a.slice(b,f).replace(/&#?\w+;/g,e),c.add(g,i,b-1),h=S_E;else throw Error("attribute value no end '"+n+"' match");else if(h==S_V)i=a.slice(b,f).replace(/&#?\w+;/g,e),c.add(g,i,b),d.warning('attribute "'+g+'" missed start quot('+
n+")!!"),b=f+1,h=S_E;else throw Error('attribute value must after "="');break;case "/":switch(h){case S_TAG:c.setTagName(a.slice(b,f));case S_E:case S_S:case S_C:h=S_C,c.closed=!0;case S_V:case S_ATTR:case S_ATTR_S:break;default:throw Error("attribute invalid close char('/')");}break;case "":d.error("unexpected end of input");case ">":switch(h){case S_TAG:c.setTagName(a.slice(b,f));case S_E:case S_S:case S_C:break;case S_V:case S_ATTR:i=a.slice(b,f),"/"===i.slice(-1)&&(c.closed=!0,i=i.slice(0,-1));
case S_ATTR_S:h===S_ATTR_S&&(i=g);h==S_V?(d.warning('attribute "'+i+'" missed quot(")!!'),c.add(g,i.replace(/&#?\w+;/g,e),b)):(d.warning('attribute "'+i+'" missed value!! "'+i+'" instead!!'),c.add(i,i,b));break;case S_EQ:throw Error("attribute value missed!!");}return f;case "\u0080":n=" ";default:if(" ">=n)switch(h){case S_TAG:c.setTagName(a.slice(b,f));h=S_S;break;case S_ATTR:g=a.slice(b,f);h=S_ATTR_S;break;case S_V:i=a.slice(b,f).replace(/&#?\w+;/g,e),d.warning('attribute "'+i+'" missed quot(")!!'),
c.add(g,i,b);case S_E:h=S_S}else switch(h){case S_ATTR_S:d.warning('attribute "'+g+'" missed value!! "'+g+'" instead!!');c.add(g,g,b);b=f;h=S_ATTR;break;case S_E:d.warning('attribute space is required"'+g+'"!!');case S_S:h=S_ATTR;b=f;break;case S_EQ:h=S_V;b=f;break;case S_C:throw Error("elements closed character '/' and '>' must be connected to");}}f++}}
function appendElement(a,b,c){for(var e=a.tagName,d=null,g=c[c.length-1].currentNSMap,i=a.length;i--;){var f=a[i],h=f.qName,n=f.value,k=h.indexOf(":");if(0<k)var j=f.prefix=h.slice(0,k),k=h.slice(k+1),j="xmlns"===j&&k;else k=h,j="xmlns"===h&&"";f.localName=k;!1!==j&&(null==d&&(d={},_copy(g,g={})),g[j]=d[j]=n,f.uri="http://www.w3.org/2000/xmlns/",b.startPrefixMapping(j,n))}for(i=a.length;i--;)if(f=a[i],j=f.prefix)if("xml"===j&&(f.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==j)f.uri=g[j];k=
e.indexOf(":");0<k?(j=a.prefix=e.slice(0,k),k=a.localName=e.slice(k+1)):(j=null,k=a.localName=e);i=a.uri=g[j||""];b.startElement(i,k,e,a);if(a.closed){if(b.endElement(i,k,e),d)for(j in d)b.endPrefixMapping(j)}else a.currentNSMap=g,a.localNSMap=d,c.push(a)}
function parseHtmlSpecialContent(a,b,c,e,d){if(/^(?:script|textarea)$/i.test(c)){var g=a.indexOf("</"+c+">",b),a=a.substring(b+1,g);if(/[&<]/.test(a)){if(/^script$/i.test(c))return d.characters(a,0,a.length),g;a=a.replace(/&#?\w+;/g,e);d.characters(a,0,a.length);return g}}return b+1}function fixSelfClosed(a,b,c,e){var d=e[c];null==d&&(d=e[c]=a.lastIndexOf("</"+c+">"));return d<b}function _copy(a,b){for(var c in a)b[c]=a[c]}
function parseDCC(a,b,c,e){switch(a.charAt(b+2)){case "-":if("-"===a.charAt(b+3)){var d=a.indexOf("--\>",b+4);if(d>b)return c.comment(a,b+4,d-b-4),d+3;e.error("Unclosed comment")}break;default:if("CDATA["==a.substr(b+3,6))return d=a.indexOf("]]\>",b+9),c.startCDATA(),c.characters(a,b+9,d-b-9),c.endCDATA(),d+3;var d=split(a,b),g=d.length;if(1<g&&/!doctype/i.test(d[0][0]))return a=d[1][0],b=3<g&&/^public$/i.test(d[2][0])&&d[3][0],e=4<g&&d[4][0],d=d[g-1],c.startDTD(a,b&&b.replace(/^(['"])(.*?)\1$/,"$2"),
e&&e.replace(/^(['"])(.*?)\1$/,"$2")),c.endDTD(),d.index+d[0].length}return-1}function parseInstruction(a,b,c){var e=a.indexOf("?>",b);return e&&(a=a.substring(b,e).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/))?(c.processingInstruction(a[1],a[2]),e+2):-1}function ElementAttributes(){}
ElementAttributes.prototype={setTagName:function(a){if(!tagNamePattern.test(a))throw Error("invalid tagName:"+a);this.tagName=a},add:function(a,b,c){if(!tagNamePattern.test(a))throw Error("invalid attribute:"+a);this[this.length++]={qName:a,value:b,offset:c}},length:0,getLocalName:function(a){return this[a].localName},getOffset:function(a){return this[a].offset},getQName:function(a){return this[a].qName},getURI:function(a){return this[a].uri},getValue:function(a){return this[a].value}};
function _set_proto_(a,b){a.__proto__=b;return a}_set_proto_({},_set_proto_.prototype)instanceof _set_proto_||(_set_proto_=function(a,b){function c(){}c.prototype=b;c=new c;for(b in a)c[b]=a[b];return c});function split(a,b){var c,e=[],d=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;d.lastIndex=b;for(d.exec(a);c=d.exec(a);)if(e.push(c),c[1])return e}"function"==typeof require&&(exports.XMLReader=XMLReader);
