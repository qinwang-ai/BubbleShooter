459e9f1c37a1d832a13a3281dcc7fad2
jsio("import lib.PubSub");
var Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_models_Model=__class__,Model=exports=Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_models_Model(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(h){function i(a){return a.split(j).map(function(a){return"]"==a[a.length-1]?parseInt(a):a})}this.init=function(a){var c;a instanceof Model&&(c=a,a={localStorage:c._storageKey},c=c._data);this._data={};
if(a&&a.localStorage&&(this._storageKey=a.localStorage,void 0===c)){var b=localStorage.getItem(this._storageKey);if(b)try{c=JSON.parse(b)}catch(d){}}this.setObject(c||{});a&&(a.values&&Object.keys(a.values).forEach(function(b){this.set(b,a.values[b])},this),a.defaults&&Object.keys(a.defaults).forEach(function(b){this.has(b)||this.set(b,a.defaults[b])},this))};this.setObject=function(a){this._data=a;this.emit();this.persist();return this};this.toObject=function(){return JSON.parse(JSON.stringify(this._data))};
this.clone=function(){return new Model(this.getObject())};var j=/[\[.,]/;this.has=function(a){return void 0!==this.get(a)};this.get=function(a){for(var a=i(a),c=a.length,b=0,d=this._data;d&&b<c;)d=d[a[b++]];return d};this.getObject=function(a){a=this.get(a)||{};return JSON.parse(JSON.stringify(a))};this.set=function(a,c){for(var b=i(a),d=b.length-1,f=0,e=this._data;e&&f<d;){var g=b[f++];e[g]||(e[g]="number"==typeof b[f]?[]:{});e=e[g]}c!=e[b[d]]&&(e[b[d]]=c,this.emit(a,c));this.persist();return this};
this.emit=function(a,c){a&&h(this,"emit",arguments);this._subscribers&&Object.keys(this._subscribers).forEach(function(b){(!a||b!=a&&(0==b.indexOf(a)||0==a.indexOf(b)))&&h(this,"emit",[b,this.get(b)])},this);return this};this.persist=function(){this._storageKey&&localStorage.setItem(this._storageKey,JSON.stringify(this._data));return this}});
