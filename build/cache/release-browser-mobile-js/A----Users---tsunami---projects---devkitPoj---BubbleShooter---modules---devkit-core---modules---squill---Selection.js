ab356741a05ae6146f065b8a4a22f381
jsio("import lib.PubSub");var Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_Selection=__class__;
exports=Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_squill_Selection(function(){return this.init&&this.init.apply(this,arguments)},lib.PubSub,function(){this.init=function(a){this._parent=a.parent;this._type=a.type||!1;this._selection=a.selectionStore||new exports.LocalStore;this._maxSelections=a.maxSelections||1;this._currentSelectionCount=0;this._lastSelected=null};this.getType=function(){return this._type};this.isSelected=function(a){"object"==typeof a&&(a=a[this._parent.getDataSource().key]);
return this._selection.isSelected(a)};this.toggle=function(a){this._setSelected(a,!this.isSelected(a[this._parent.getDataSource().key]))};this.select=function(a){(this._currentSelectionCount<this._maxSelections||"single"==this._type)&&this._setSelected(a,!0)};this.deselect=function(a){this._setSelected(a,!1)};this.clear=this.deselectAll=function(){this._selection.deselectAll();this._currentSelectionCount=0};this.get=function(){return 1==this._maxSelections?Object.keys(this._selection.get())[0]:Object.keys(this._selection.get())};
this.getSelectionCount=function(){return this._currentSelectionCount};this._setSelected=function(a,d){if(a){var b=this._parent.getDataSource(),c=b.key;if("string"==typeof a&&(a=b.get(a),!a))return;b=a[c];this._selection.isSelected(b)!=d&&(d?(this._lastSelected&&"single"==this._type&&(c=this._lastSelected[c],this._selection.deselect(c),this._currentSelectionCount--,this.publish("Deselect",this._lastSelected,c)),this._lastSelected=a,this._selection.select(b),this._currentSelectionCount++):(this._selection.deselect(b),
this._currentSelectionCount--),this.publish(d?"Select":"Deselect",a,b))}}});exports.LocalStore=__class__;
exports.LocalStore=exports.LocalStore(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){this._store={}};this.get=function(){return merge({},this._store)};this.select=function(a){this._store[a]=!0};this.deselect=function(a){delete this._store[a]};this.deselectAll=function(){this._store={}};this.isSelected=function(a){if(void 0!==a)return!!this._store[a];for(var d in this._store)return!0;return!1}});
