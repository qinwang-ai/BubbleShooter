68331931e508e42b855846e10fa73cf4
jsio("from util.browser import $");jsio("import timer");jsio("import .FontLoader");jsio("import ui.resource.Font as Font");var Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_webgl_TextManager=__class__;
exports=Users_tsunami_projects_devkitPoj_BubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_webgl_TextManager(function(){return this.init&&this.init.apply(this,arguments)},function(){this.init=function(){this._buffers={};this._numBuffers=0};this.get=function(a,b,d){var f=a.font,g=Font.parse(f);if(isFontLoaded(g.getOrigName())){g=(d?a.lineWidth+"|"+a.strokeStyle+"|":"-|"+a.fillStyle)+"|"+f+"|"+b;if(!this._buffers[g]){if(500<this._numBuffers){var i=Infinity,e=null,c;for(c in this._buffers){var h=
this._buffers[c].lastUsed;h<i&&(i=h,e=c)}a.deleteTextureForImage(this._buffers[e].image);delete this._buffers[e]}else++this._numBuffers;c=document.createElement("canvas");c.complete=!0;this._buffers[g]={lastUsed:0,image:c,metrics:this._render(c,b,f,d,a.fillStyle,a.strokeStyle,a.lineWidth)}}this._buffers[g].lastUsed=timer.now;return this._buffers[g]}};this._render=function(a,b,d,f,g,i,e){var c=a.getContext("2d"),h=getTextHeight(d);c.font=d;a.width=c.measureText(b).width+e;a.height=h.height+e;c.textBaseline=
"top";c.font=d;f?(c.strokeStyle=i,c.lineWidth=e,c.strokeText(b,e/2,e/2)):(c.fillStyle=g,c.fillText(b,0,0));return h}});var heightMeasure=document.body.appendChild(document.createElement("div")),contents=heightMeasure.appendChild(document.createElement("span"));$.setText(contents,"Hg");var baselineDiv=heightMeasure.appendChild(document.createElement("div"));baselineDiv.style.cssText="display: inline-block; width: 1px; height: 0px; vertical-align: baseline";var bottomDiv=heightMeasure.appendChild(document.createElement("div"));
bottomDiv.style.cssText="display: inline-block; width: 1px; height: 0px; vertical-align: bottom";heightMeasure.style.cssText="position: absolute; top: 0px; left: -1000px; visibility: hidden; pointer-events: none";var _fontHeightCache={};
function getTextHeight(a){if(!_fontHeightCache[a]){heightMeasure.style.font=a;var b={ascent:baselineDiv.getBoundingClientRect().top,height:bottomDiv.getBoundingClientRect().top,descent:0};b.descent=b.height-b.ascent;_fontHeightCache[a]=b}return _fontHeightCache[a]}var isFontLoaded=function(){function a(a){f[a]=!0;(new FontLoader([a],{fontLoaded:function(){d[a]=!0},fontsLoaded:function(a){a&&console.error(a)}},b)).loadFonts()}var b=3E4,d={},f={};return function(b){f[b]||a(b);return d[b]}}();
